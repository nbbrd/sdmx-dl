syntax = "proto3";
option java_multiple_files = true;

package sdmxdl.grpc;

import "sdmxdl_api.proto";
import "sdmxdl_web.proto";

service SdmxWebManager {

  rpc GetAbout(EmptyDto) returns (sdmxdl.format.protobuf.AboutDto);

  rpc GetSources(EmptyDto) returns (stream sdmxdl.format.protobuf.web.WebSourceDto);

  rpc GetMonitorReport(SourceRequestDto) returns (sdmxdl.format.protobuf.web.MonitorReportDto);

  rpc GetDatabases(SourceRequestDto) returns (stream sdmxdl.format.protobuf.DatabaseDto);

  rpc GetFlows(DatabaseRequestDto) returns (stream sdmxdl.format.protobuf.FlowDto);

  rpc GetMeta(FlowRequestDto) returns (sdmxdl.format.protobuf.MetaSetDto);

  rpc GetData(KeyRequestDto) returns (sdmxdl.format.protobuf.DataSetDto);

  rpc GetDataStream(KeyRequestDto) returns (stream sdmxdl.format.protobuf.SeriesDto);

  rpc GetAvailability(KeyDimensionRequestDto) returns (stream DimensionCodesDto);
}

message EmptyDto {
}

message SourceRequestDto {
  string source = 1;
  optional string languages = 2;
}

message DatabaseRequestDto {
  string source = 1;
  optional string database = 2;
  optional string languages = 3;
}

message FlowRequestDto {
  string source = 1;
  string flow = 2;
  optional string database = 3;
  optional string languages = 4;
}

message KeyRequestDto {
  string source = 1;
  string flow = 2;
  string key = 3;
  optional string database = 4;
  optional string languages = 5;
}

message KeyDimensionRequestDto {
  string source = 1;
  string flow = 2;
  string key = 3;
  int32 dimension = 4;
  optional string database = 5;
  optional string languages = 6;
}

message DimensionCodesDto {
  repeated string codes = 1;
}